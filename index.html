<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Coral Tree Menu</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            color: #FFD700;
            font-family: Arial, sans-serif;
        }
        #description {
            position: absolute;
            top: 20%;
            left: 60%;
            max-width: 350px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            color: #FFD700;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none; /* Makes it non-interactive */
            z-index: 1;
        }
        h2, h3 {
            margin: 10px 0;
        }
        p {
            margin: 10px 0;
            line-height: 1.6;
        }
        .line {
            position: absolute;
            background-color: #FFD700;
            height: 2px;
            width: 0;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script>
        let menuItems = [
            { title: "Home", subtitle: "Welcome Home", text: "Sample Text for Home" },
            { title: "About", subtitle: "Who We Are", text: "Sample Text for About" },
            { title: "Services", subtitle: "What We Do", text: "Sample Text for Services" },
            { title: "Portfolio", subtitle: "Our Work", text: "Sample Text for Portfolio" },
            { title: "Blog", subtitle: "Latest News", text: "Sample Text for Blog" }
        ];

        let branches = [];
        let coralX, coralY;
        let maxDepth = 6;
        let waveOffset = 0;
        let closestBranch = null;
        let showText = false;
        let lineProgress = 0;
        let waveMovement = 0;
        let selectedBranch = null;
        let descriptionElement = null;
        let lineElement = null;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            coralX = width * 0.3;
            coralY = height;
            generateCoral(coralX, coralY, -PI / 2, 200, maxDepth);
            descriptionElement = createDiv('').id('description');
            lineElement = createDiv('').id('line').addClass('line');
            console.log(branches);  // Debugging line
        }

        function draw() {
            background(0);
            stroke(255, 215, 0, 180);
            let minDist = Infinity;
            closestBranch = null;

            waveMovement = sin(frameCount * 0.01) * 5; 

            branches.forEach(branch => {
                let d = dist(mouseX, mouseY, branch.x1 + waveMovement, branch.y1);
                if (d < minDist && branch.depth === 1) { 
                    minDist = d;
                    closestBranch = branch;
                    selectedBranch = branch;
                    showText = true;
                    lineProgress = 0; 
                }

                let openFactor = constrain(map(d, 0, 300, 0.6, 1), 0.6, 1);
                let branchAngleOffset = sin(waveOffset + branch.noiseOffset) * 5 * (1 / (branch.depth + 1));
                let x2 = lerp(branch.x1, branch.x2 + branchAngleOffset, openFactor);
                let y2 = lerp(branch.y1, branch.y2 + branchAngleOffset, openFactor);

                strokeWeight(branch.thickness);
                stroke(255, 215, 0, 150 + 50 * sin(branch.noiseOffset)); 
                line(branch.x1 + waveMovement, branch.y1, x2 + waveMovement, y2);
            });

            if (closestBranch && closestBranch.label) {
                lineProgress = min(lineProgress + 0.05, 1);
                animateLine(closestBranch);
                drawTextBox(closestBranch);
            } else {
                showText = false; 
                lineElement.style('width', '0px'); // Hide line
            }

            waveOffset += 0.01;
        }

        function generateCoral(x, y, angle, length, depth) {
            if (depth > 0) {
                let angleVariation = PI / 9; 
                let xEnd = x + cos(angle) * length;
                let yEnd = y + sin(angle) * length;

                let thickness = map(depth, maxDepth, 1, 18, 2);
                let noiseOffset = random(1000);
                if (depth === 1) {
                    branches.push({
                        x1: x, y1: y, x2: xEnd, y2: yEnd, 
                        thickness: thickness, noiseOffset: noiseOffset, 
                        depth: depth, label: menuItems[branches.length] 
                    });
                }

                generateCoral(xEnd, yEnd, angle + random(-angleVariation, angleVariation), length * 0.7, depth - 1);
                generateCoral(xEnd, yEnd, angle + random(-angleVariation, angleVariation), length * 0.7, depth - 1);
            }
        }

        function animateLine(branch) {
            let startX = branch.x1 + waveMovement;
            let startY = branch.y1;
            let endX = descriptionElement.elt.offsetLeft + 40;
            let endY = descriptionElement.elt.offsetTop + 30;
            let lineWidth = dist(startX, startY, endX, endY) * lineProgress;
            lineElement.style('width', lineWidth + 'px');

            let angle = atan2(endY - startY, endX - startY);
            let offsetX = cos(angle) * lineWidth;
            let offsetY = sin(angle) * lineWidth;

            lineElement.style('left', startX + 'px');
            lineElement.style('top', startY + 'px');
            lineElement.style('transform', `rotate(${angle}rad)`);
        }

        function drawTextBox(branch) {
            descriptionElement.html(branch.label.title + '<br>' + branch.label.subtitle + branch.label.text);
            descriptionElement.style('opacity', '1');
        }

        function mouseMoved() {
            if (!selectedBranch) {
                showText = false;
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            coralX = width * 0.3;
            coralY = height;
        }
    </script>
</body>
</html>
